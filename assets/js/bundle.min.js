"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function navBrandAnimation(classSelector,timer,nestedTimer){for(var $navLogos=document.getElementsByClassName(classSelector),i=0;i<=$navLogos.length;i++){var innerVar=0;setTimeout(function(j){if(void 0!==$navLogos[j]){var el=$navLogos[j];el.style.display="inherit",el.className+=" flip-in",setTimeout(function(){el.className+=" flip-out",setTimeout(function(){innerVar++,el.style="",el.className=classSelector,innerVar===$navLogos.length&&mainNavBrandAnimation("main-logo-animation")},nestedTimer*i)},nestedTimer*i)}}.bind(null,i),timer*i)}}function mainNavBrandAnimation(classSelector){for(var $navLogos=document.getElementsByClassName(classSelector),i=0;i<$navLogos.length;i++){var el=$navLogos[i];el.style.display="inherit",el.className+=" flip-in"}}function toggleDropdownMobile(){for(var $dropDown=document.getElementsByClassName("nav-dropdown"),i=0;i<$dropDown.length;i++){var el=$dropDown[i];listenFor(document.getElementsByClassName(el.classList[1])[0])}}function listenFor(el){el.addEventListener("click",function(){for(var $activeEl=document.getElementsByClassName("nav-dropdown active"),i=0;i<$activeEl.length;i++){var $active=$activeEl[i];$active!==el&&($active.className=$active.className.replace(/\bactive\b/g,""))}el.classList.contains("active")?el.className=el.className.replace(/\bactive\b/g,""):el.className+=" active"})}function enableTabs(querySelector){for(var myTabsCollection=document.getElementById(querySelector).getElementsByTagName("a"),i=0;i<myTabsCollection.length;i++)new Tab(myTabsCollection[i])}if(window.attachEvent&&!window.addEventListener){var $body=document.body;$body.innerHTML='<!-- #failureIE --> <div id="failureIE"> You are using an <strong>outdated</strong> browser. Please <a href="//browsehappy.com/">upgrade your browser</a> to improve your experience. </div> <!-- #failureIE -->'}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_jscallog=function(msg){},_jsCalWrapper={instances:{}},_a=function(tag,classes,parentElem){var elem=document.createElement(tag);return elem.className=classes||"",parentElem&&parentElem.appendChild(elem),elem},JSCalendarEvent=function(){function JSCalendarEvent(data,calendar,position){if(_classCallCheck(this,JSCalendarEvent),!data)return!1;this.setData(data),this.setID(data.id),this.position=position,this.options=calendar.options,this.calendar=calendar,this.buildElements(),this.updateElements(),this.bindEvents()}return _createClass(JSCalendarEvent,[{key:"setID",value:function(id){this.id=id}},{key:"getID",value:function(){return this.id}},{key:"setData",value:function(data){this.at=data.at&&new Date(data.at),this.duration=data.duration,this.displayname=data.displayname,this.color=data.color,this.html=data.html}},{key:"formatDuration",value:function(d){var append=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",prepend=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";if(!d)return"";d=Math.floor(d/1e3/60);var h=Math.floor(d/60),m=d%60;return append+(h?h+"h ":"")+(m?m+"mins":"")+prepend}},{key:"formatTime",value:function(t){var h=t.getHours(),m=t.getMinutes(),s=t.getSeconds(),append="";return this.options.ampm&&(11<h?(h-=12==h?0:12,append=" PM"):append=" AM"),h+(m<10?":0":":")+m+(this.displaySeconds?(s<10?":0":":")+s:"")+append}},{key:"buildElements",value:function(){this.monthElem=_a("div","cell-event-mark"),this.weekElem=_a("div","cal-week-day-event-col"),this.dayElem=_a("div","cal-total-day-event-view")}},{key:"updateElements",value:function(){var monthElem=this.monthElem,weekElem=this.weekElem,dayElem=this.dayElem;if(this.at){var dateText=this.formatTime(new Date(this.at));monthElem.textContent=dateText,monthElem.dataset.at=this.at}if(this.displayname){var shortname=this.displayname.substring(0,this.options.titleCropSize);monthElem.textContent+=(this.at?" - ":"")+shortname+(shortname.length!=this.displayname?"...":"")}if(monthElem.style.background=this.color||this.options.eventBackground,this.displayname?(weekElem.classList.add("text-injected"),weekElem.textContent=this.displayname):this.html?(weekElem.innerHTML=this.html,weekElem.classList.add("html-injected")):(weekElem.classList.add("not-injected"),weekElem.textContent=this.options.nonameEventVocab),weekElem.style.background=this.color||this.options.eventBackground,!this.at&&weekElem.classList.add("no-starting-time"),!this.duration&&weekElem.classList.add("no-duration"),this.at){var outputString=void 0;if(outputString=this.formatTime(this.at),this.duration){var end=new Date(this.at.getTime()+this.duration);outputString+=" - "+this.formatTime(end)}(weekElem.querySelector(".cal-week-day-time-float")||_a("span","cal-week-day-time-float",weekElem)).textContent=outputString}var gapMinuteSize=this.options.dayviewGapMinutes,gapsPerHour=60/gapMinuteSize;(this.gapcell=-1,this.at?this.gapcell=this.at.getHours()*gapsPerHour+this.at.getMinutes()/gapMinuteSize:dayElem.classList.add("no-time"),this.gapcount=this.options.dayviewNoTimeGapSize,this.duration?this.gapcount=Math.ceil(this.duration/1e3/60/gapMinuteSize):dayElem.classList.add("no-duration"),dayElem.style.background=this.color||this.options.eventBackground,dayElem.style.height=this.gapcount*this.options.dayviewGapHeight-2+"px",this.at&&(this.daytop=this.gapcell*this.options.dayviewGapHeight,dayElem.style.top=this.daytop+"px",dayElem.style.right="0px",dayElem.style.left="0px",dayElem.style.zIndex=Math.floor(this.gapcell)),(dayElem.querySelector(".cal-total-day-displayname")||_a("div","cal-total-day-displayname",dayElem)).textContent=this.displayname||this.options.nonameEventVocab,this.at)&&((dayElem.querySelector(".cal-total-day-time")||_a("div","cal-total-day-time",dayElem)).textContent=this.formatTime(new Date(this.at))+this.formatDuration(this.duration,", "))}},{key:"getDayGap",value:function(){return this.gapcell}},{key:"dragging",value:function(){this.monthElem.classList.add("dragged"),this.weekElem.classList.add("dragged"),this.dayElem.classList.add("dragged"),this.calendar.dragging(this)}},{key:"dropped",value:function(){this.monthElem.classList.remove("dragged"),this.weekElem.classList.remove("dragged"),this.dayElem.classList.remove("dragged"),this.calendar.dropped(this)}},{key:"bindEvents",value:function(){var _this=this;this.monthElem.addEventListener("mousedown",function(){window.addEventListener("mouseup",function finish(){window.removeEventListener("mouseup",finish),_this.dropped()}),_this.dragging()}),this.weekElem.addEventListener("mousedown",function(){window.addEventListener("mouseup",function finish(){window.removeEventListener("mouseup",finish),_this.dropped()}),_this.dragging()}),this.dayElem.addEventListener("mousedown",function(ev){window.addEventListener("mouseup",function finish(){window.removeEventListener("mouseup",finish),_this.dropped()}),_this.originalY=ev.y,_this.potentialnewtop=_this.daytop,_this.dragging()}),this.monthElem.addEventListener("click",function(){_this.calendar.fire("click",_this)}),this.weekElem.addEventListener("click",function(){_this.calendar.fire("click",_this)})}},{key:"render",value:function(view,container){container.appendChild(this[view+"Elem"])}},{key:"destroy",value:function(){this.monthElem&&this.monthElem.remove(),this.weekElem&&this.weekElem.remove(),this.dayElem&&this.dayElem.remove(),this.monthElem=void 0,this.weekElem=void 0,this.dayElem=void 0}}]),JSCalendarEvent}(),JSCalendar=function(){function JSCalendar(elem,options){if(_classCallCheck(this,JSCalendar),this.elem=elem,this.id=elem.id,this.options=Object.assign(JSCalendar.defaultOptions,options||{defaultOptions:!0}),this.state=JSCalendar.createState(),this.hooks={},Math.floor(60/this.options.dayviewGapMinutes)!=60/this.options.dayviewGapMinutes)throw new Error("Option dayviewGapMinutes must be a divisor of 60");this.fire("new")}return _createClass(JSCalendar,[{key:"init",value:function(done){return _jscallog("Created new instance with id : "+this.id),this.fire("init"),this.createStructure(),this.options.datasource?this.fetch(done):this.render()}},{key:"createStructure",value:function(){var _this2=this;JSCalendar.emptyElem(this.elem),this.elem.classList.add("js-calendar"),this.controlbar=_a("div","control-bar",this.elem),this.tablewrapper=_a("div","calendar-wrapper",this.elem),this.table=_a("table","calendar-table",this.tablewrapper),this.viewcontroller=_a("div","control-bar-widget control-bar-views",this.controlbar),this.actioncontroller=_a("div","control-bar-widget control-bar-actions",this.controlbar),this.titlecontroller=_a("div","control-bar-widget control-bar-title",this.controlbar),this.options.views.forEach(function(v){var word=_this2.options.viewsVocab[v]||v,button=_a("button","control-button change-view change-view-"+v,_this2.viewcontroller);button.addEventListener("click",function(){_this2.setView(v)}),button.textContent=word}),this.options.buttons.forEach(function(b){var word=_this2.options.buttonsVocab[b]||b,button=_a("button","control-button calendar-action calendar-action-"+b,_this2.actioncontroller),action=_this2.options.buttonsActions[b];button.addEventListener("click",function(){"function"==typeof action?action(_this2):_this2[action]()}),button.textContent=word})}},{key:"goNow",value:function(){var now=new Date;return this.state.year=now.getFullYear(),this.state.month=now.getMonth(),this.state.day=now.getDate(),this.state.weekday=now.getDay(),this.adjustDateToView(),this.render()}},{key:"goBack",value:function(){if("day"==this.state.view){if(this.state.day--,0==this.state.day){this.state.month--,0==this.state.month&&(this.state.month=11,this.state.year--);var monthStat=JSCalendar.getDaysInMonth(this.state.year,this.state.month);this.state.day=monthStat.numberOfDays}}else if("month"==this.state.view)this.state.month--,this.state.month<0&&(this.state.month=11,this.state.year--);else if("week"==this.state.view&&(this.state.day-=7,this.state.day=this.state.day-this.state.day%7,this.state.day<=0)){this.state.month--,-1==this.state.month&&(this.state.month=11,this.state.year--);var _monthStat=JSCalendar.getDaysInMonth(this.state.year,this.state.month);this.state.day=_monthStat.numberOfDays+this.state.day}return this.render()}},{key:"goNext",value:function(){if("day"==this.state.view){var monthStat=JSCalendar.getDaysInMonth(this.state.year,this.state.month);this.state.day++,this.state.day>monthStat.numberOfDays&&(this.state.day=1,this.state.month++,11<this.state.month&&(this.state.month=0,this.state.year++))}else if("month"==this.state.view)this.state.month++,11<this.state.month&&(this.state.month=0,this.state.year++);else if("week"==this.state.view){var _monthStat2=JSCalendar.getDaysInMonth(this.state.year,this.state.month);this.state.day+=7,this.state.day>_monthStat2.numberOfDays&&(this.state.month++,12==this.state.month&&(this.state.month=0,this.state.year++),this.state.day=this.state.day-_monthStat2.numberOfDays)}return this.render()}},{key:"goToDay",value:function(position){var date=position.split("-");date=new Date(date[0],date[1],date[2]),this.state.year=date.getFullYear(),this.state.month=date.getMonth(),this.state.day=date.getDate(),this.setView("day")}},{key:"push",value:function(item){if(this.fire("willPush",item),item.at){var date=new Date(item.at);this.validateCell(date.getFullYear(),date.getMonth(),date.getDate()),this.state.matrix[date.getFullYear()][date.getMonth()][date.getDate()].push(new JSCalendarEvent(item.event,this,date.getFullYear()+"-"+date.getMonth()+"-"+date.getDate())),this.fire("pushed",item)}else this.fire("didNotPush",item);return this}},{key:"on",value:function(event,callback){return this.hooks[event]=this.hooks[event]||[],this.hooks[event].push(callback),this}},{key:"fire",value:function(event,extra){var _this3=this;return _jscallog("Firing event '"+event+"'"),JSCalendar.fire(event,this,extra),(this.hooks[event]||[]).forEach(function(e){e(_this3,extra)}),this}},{key:"destroy",value:function(){for(var year in this.state.matrix)for(var month in this.state.matrix[year])for(var day in this.state.matrix[year][month])for(var i=0;i<this.state.matrix[year][month][day].length;i++)this.state.matrix[year][month][day][i].destroy();return delete this.elem,delete this.tablewrapper,delete this.controlbar,delete this.table,delete _jsCalWrapper[this.id],this}},{key:"adjustDateToView",value:function(){"week"==this.state.view&&this.state.weekday!=this.state.day&&this.state.day<8&&(this.state.month--,this.state.day=JSCalendar.getDaysInMonth(this.state.year,this.state.month).numberOfDays)}},{key:"getDateAppendee",value:function(){var d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.state.day;return 3<d&&d<21?this.options.nthVocab.default:this.options.nthVocab[d.toString().slice(-1)]||this.options.nthVocab.default}},{key:"setView",value:function(view){return this.fire("viewWillChange"),this.state.view!=view&&(this.state.view=view,this.adjustDateToView(),this.render(),this.fire("viewChanged")),this}},{key:"render",value:function(){var _this4=this;this.fire("willRender"),_jscallog("Rendering instance "+this.id);var benchStart=Date.now();return this.fetch(function(){switch(JSCalendar.emptyElem(_this4.table),_this4.state.view){case"day":_this4.renderDay();break;case"week":_this4.renderWeek();break;case"month":default:_this4.renderMonth()}_this4.updateControls(),_this4.fire("rendered"),_jscallog("Rendering benchmark : "+(Date.now()-benchStart)+"ms")},this.options.alwaysFetch),this}},{key:"renderDay",value:function(){var _this5=this;this.titlecontroller.textContent=this.options.monthsVocab[this.state.month]+" "+this.state.day+this.getDateAppendee()+", "+this.state.year;var dayrow=_a("tr","cal-week-day-row",this.table),daycol=_a("td","cal-week-day-col",dayrow);this.validateCell();var events=this.state.matrix[this.state.year][this.state.month][this.state.day],noTimeWrap=_a("div","single-day-no-time-wrap",daycol),timetable=_a("div","single-day-time-table",daycol),eventwrap=_a("div","cal-total-day-event-wrap",timetable);events.filter(function(e){return!e.at}).forEach(function(e){e.render(_this5.state.view,noTimeWrap)}),eventwrap.addEventListener("mousemove",function(ev){if(_this5.state.dragging){var top=_this5.state.dragged.daytop-(_this5.state.dragged.originalY-ev.y);_this5.state.dragged.dayElem.style.top=top+"px",_this5.state.dragged.potentialnewtop=top}});for(var minGap=this.options.dayviewGapMinutes,gapsPerHour=Math.ceil(60/minGap),gapindex=0,h=0;h<24;h++)for(var gapi=0;gapi<gapsPerHour;gapi++){var minutesBlock=_a("div","hour-block gap-"+ ++gapindex,timetable),timespan=_a("span","minutes-block-time",minutesBlock);minutesBlock.classList.add(0==gapi?"hour-gap":"minutes-gap");var mins=gapi*minGap,dh=h,appendee="";minutesBlock.style.height=this.options.dayviewGapHeight-1+"px",this.options.ampm&&(h<12?appendee="AM":(dh-=12==dh?0:12,appendee="PM")),timespan.textContent=dh+":"+(mins<10?"0":"")+mins+appendee,minutesBlock.dataset.gapindex=gapindex}var groups={},smallestGap=-1;events.filter(function(e){return e.at}).forEach(function(e){e.render(_this5.state.view,eventwrap),e.ratio=100,e.dayElem.style.left="0",e.dayElem.style.right="0";var totalgaps=e.gapcount;Math.floor(e.gapcell)!=e.gapcell&&totalgaps++;for(var i=0;i<totalgaps;i++){var g=Math.floor(e.gapcell+i);groups[g]||(groups[g]=[]),groups[g].push(e)}(-1==smallestGap||smallestGap>e.gapcell)&&(smallestGap=e.gapcell)});var _loop=function(gap){var total=groups[gap].length,ratio=100/total,index=0;groups[gap].forEach(function(e){var minleft=index*ratio,minright=ratio*(total-index-1);ratio<e.ratio&&(e.ratio=ratio,e.dayElem.style.left=minleft+"%",e.dayElem.style.right=minright+"%"),index++})};for(var gap in groups)_loop(gap);this.state.skipscroll?this.state.skipscroll=!1:this.tablewrapper.scrollTop=smallestGap*this.options.dayviewGapHeight}},{key:"renderWeek",value:function(){var _this6=this,dayrow=_a("tr","cal-week-day-row",this.table),daycol=_a("td","cal-week-day-col",dayrow),dayObj=(JSCalendar.getDaysInMonth(this.state.year,this.state.month),new Date(this.state.year,this.state.month,this.state.day)),firstDay=new Date(dayObj.getTime()-864e5*dayObj.getDay()),lastDay=new Date(firstDay.getTime()+5184e5);this.validateCell(firstDay.getFullYear(),firstDay.getMonth(),firstDay.getDate()),this.validateCell(lastDay.getFullYear(),lastDay.getMonth(),lastDay.getDate()),_jscallog("Rending matrix week");for(var cDay=new Date(firstDay.getTime()),_loop2=function(i){var y=cDay.getFullYear(),m=cDay.getMonth(),d=cDay.getDate(),w=cDay.getDay(),t=cDay.getTime(),daysep=_a("div","cal-week-day-sep",daycol);daysep.textContent=_this6.options.daysVocab[w]+", "+_this6.options.monthsVocab[m]+" "+d;var daycontainer=_a("div","col-week-day-container",daycol);if(_this6.state.matrix[y][m][d])for(var events=_this6.state.matrix[y][m][d],j=0;j<events.length;j++){events[j].render(_this6.state.view,daycontainer)}var fulldate=y+"-"+m+"-"+d;daycontainer.dataset.fulldate=fulldate,daycontainer.dataset.at=cDay.getTime(),daycontainer.addEventListener("mouseenter",function(){_this6.state.dragging&&(daycontainer.appendChild(_this6.state.dragged.weekElem),_this6.state.newPosition=fulldate,_this6.state.newAt=cDay.getTime())}),daysep.addEventListener("click",function(){_this6.goToDay(fulldate)}),_a("div","cal-week-day-no-event-col",daycontainer).textContent=_this6.options.emptyDayVocab,cDay=new Date(t+864e5)},i=0;i<7;i++)_loop2();var firstDayAppend=this.getDateAppendee(firstDay.getDate()),lastDayAppend=this.getDateAppendee(lastDay.getDate());firstDay.getMonth()==lastDay.getMonth()?this.titlecontroller.textContent=this.options.monthsVocab[firstDay.getMonth()]+" "+firstDay.getDate()+firstDayAppend+" - "+lastDay.getDate()+lastDayAppend+", "+this.state.year:firstDay.getYear()==lastDay.getYear()?this.titlecontroller.textContent=this.options.monthsVocab[firstDay.getMonth()]+" "+firstDay.getDate()+firstDayAppend+" - "+this.options.monthsVocab[lastDay.getMonth()]+" "+lastDay.getDate()+lastDayAppend+", "+this.state.year:this.titlecontroller.textContent=this.options.monthsVocab[firstDay.getMonth()]+" "+firstDay.getDate()+firstDayAppend+", "+firstDay.getFullYear()+" - "+this.options.monthsVocab[lastDay.getMonth()]+" "+lastDay.getDate()+lastDayAppend+", "+lastDay.getFullYear()}},{key:"renderMonth",value:function(){for(var _this7=this,month=JSCalendar.getDaysInMonth(this.state.year,this.state.month),startAt=-month.firstDay,totalDays=month.numberOfDays,now=new Date,isCurrentMonth=now.getMonth()==this.state.month&&now.getFullYear()==this.state.year,currentDay=now.getDate(),titleRow=_a("tr","jscal-weekday-row",this.table),day=0;day<this.options.daysVocab.length;day++){_a("td","js-cal-weekday",titleRow).textContent=this.options.daysVocab[day]}for(var row=0;row<6;row++)for(var tr=_a("tr","jscal-row row"+row,this.table),_loop3=function(col){var date=new Date(_this7.state.year,_this7.state.month,++startAt),td=_a("td","jscal-col row"+row+"col"+col,tr),daySpan=_a("span","cell-number",td);if(startAt<=0||totalDays<startAt){td.classList.add("notinmonth"),daySpan.textContent=date.getDate()}else daySpan.classList.add("not-in-month"),daySpan.textContent=date.getDate();isCurrentMonth&&currentDay==startAt&&td.classList.add("cell-today"),tr.appendChild(td),_this7.validateCell(date.getFullYear(),date.getMonth(),date.getDate());var events=_this7.state.matrix[date.getFullYear()][date.getMonth()][date.getDate()];if(events)for(var k=0;k<events.length;k++)events[k].render(_this7.state.view,td);var fulldate=date.getFullYear()+"-"+date.getMonth()+"-"+date.getDate();td.dataset.at=date.getTime(),td.dataset.fulldate=fulldate,td.addEventListener("mouseenter",function(){_this7.state.dragging&&(td.appendChild(_this7.state.dragged.monthElem),_this7.state.newPosition=td.dataset.fulldate,_this7.state.newAt=td.dataset.at)}),daySpan.addEventListener("click",function(){_this7.goToDay(fulldate)})},col=0;col<7;col++)_loop3(col);this.titlecontroller.textContent=this.options.monthsVocab[this.state.month]+" "+this.state.year}},{key:"updateControls",value:function(){var oldState=this.controlbar.querySelector(".active");oldState&&oldState.classList.remove("active");var button=this.controlbar.querySelector(".change-view-"+this.state.view);button&&button.classList.add("active")}},{key:"setDate",value:function(year,month,day,rerender){this.state.year=year,this.state.month=month,this.state.day=day,this.state.weekday=new Date(year,month,day).getDay(),rerender&&this.render()}},{key:"validateCell",value:function(){var year=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.state.year,month=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.state.month,day=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.state.day;this.state.matrix[year]||(this.state.matrix[year]={0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),this.state.matrix[year][month]||(this.state.matrix[year][month]={}),this.state.matrix[year][month][day]||(this.state.matrix[year][month][day]=[])}},{key:"moveCell",value:function(ev){var oldPos=ev.position,newPos=this.state.newPosition;if(!ev)return this.fire("cellDidNotMove",{event:ev,reason:new Error("moveCell was fired without an event")});if(this.fire("cellMightMove",ev),"day"==this.state.view){if(!ev.potentialnewtop||ev.potentialnewtop==ev.daytop)return this.fire("click",ev);var newtop=ev.potentialnewtop,newgap=(newtop-=newtop%this.options.dayviewGapHeight)/this.options.dayviewGapHeight;if(newgap!=ev.gapcell){ev.gapcell=newgap,ev.dayElem.style.top=newtop+"px",ev.daytop=newtop;var totalMinutes=newgap*this.options.dayviewGapMinutes,oldat=ev.at;ev.at=new Date(this.state.year,this.state.month,this.state.day,0,totalMinutes),ev.updateElements(),this.fire("cellMoved",{event:ev,oldtime:oldat,newtime:ev.at}),this.state.skipscroll=!0,this.render()}else ev.dayElem.style.top=newtop+"px",this.fire("cellDidNotMove",{event:ev,reason:new Error("Distance between click and drop not big enough")})}else if(newPos&&newPos!=oldPos){this.fire("cellWillMove",{event:ev,oldPosition:oldPos,newPosition:newPos});var oldPosObj=oldPos.split("-"),newPosObj=newPos.split("-"),dayCell=this.state.matrix[oldPosObj[0]][oldPosObj[1]][oldPosObj[2]],_index=dayCell?dayCell.indexOf(ev):-1,newAt=new Date(ev.at);if(newAt.setDate(newPosObj[2]),newAt.setMonth(newPosObj[1]),newAt.setFullYear(newPosObj[0]),ev.at=newAt,-1!=_index){dayCell.splice(_index,1),this.validateCell(newPosObj[0],newPosObj[1],newPosObj[2]);var arr=this.state.matrix[newPosObj[0]][newPosObj[1]][newPosObj[2]];arr=arr||[],(this.state.matrix[newPosObj[0]][newPosObj[1]][newPosObj[2]]=arr).push(ev),ev.position=newPos,this.fire("cellMoved",{event:ev,oldPosition:oldPos,newPosition:newPos,newtime:ev.at})}else this.fire("cellDidNotMove",{event:ev,reason:new Error("Could not find cell in matrix")})}else this.fire("cellDidNotMove",{event:ev,reason:new Error("Position did not change")})}},{key:"dragging",value:function(ev){this.fire("dragging",ev),this.state.dragging=!0,this.state.dragged=ev,this.state.newPosition=void 0,this.elem.classList.add("dragging")}},{key:"dropped",value:function(ev){this.fire("dropped",ev),this.moveCell(ev),this.state.dragging=!1,this.state.dragged=void 0,this.elem.classList.remove("dragging")}},{key:"appendMatrix",value:function(matrix,rerender){var _this8=this;this.fire("matrixWillAppend");var newMatrix=this.state.matrix,_loop4=function(year){newMatrix[year]||(newMatrix[year]={0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}});var monthsToMerge=matrix[year],_loop5=function(month){var days=matrix[year][month],_loop6=function(day){var _newMatrix$year$month;newMatrix[year][month][day]||(newMatrix[year][month][day]=[]),(_newMatrix$year$month=newMatrix[year][month][day]).push.apply(_newMatrix$year$month,_toConsumableArray(matrix[year][month][day].map(function(e){return new JSCalendarEvent(e,_this8,year+"-"+month+"-"+day)})))};for(var day in days)_loop6(day)};for(var month in monthsToMerge)_loop5(month)};for(var year in matrix)_loop4(year);return this.fire("matrixAppended"),rerender&&this.render(),this}},{key:"setMatrix",value:function(matrix,rerender){for(var year in _jscallog("Setting new matrix to instance "+this.id),this.fire("matrixWillSet"),matrix||(matrix=JSCalendar.defaultMatrix()),this.state.matrix=matrix,this.state.matrix)for(var month in this.state.matrix[year])for(var day in this.state.matrix[year][month])for(var i=0;i<this.state.matrix[year][month][day].length;i++)this.state.matrix[year][month][day][i]=new JSCalendarEvent(this.state.matrix[year][month][day][i],this,year+"-"+month+"-"+day);return _jscallog("No problem setting new matrix to instance "+this.id),this.fire("matrixSet"),this.state.matrixmonth=this.state.month,rerender&&this.render(),this}},{key:"debug",value:function(){var matrix={};for(var day in this.state.matrix[this.state.year][this.state.month]){var _events=this.state.matrix[this.state.year][this.state.month][day];matrix[day]=_events.map(function(e){return{displayname:e.displayname,at:new Date(e.at),duration:e.duration}})}return{year:this.state.year,month:this.state.month,day:this.state.day,weekday:this.state.weekday,view:this.state.view,monthMatrix:matrix}}},{key:"fetch",value:function(done,force){var _this9=this;if(!force&&this.state.matrix[this.state.year]&&this.state.matrix[this.state.year][this.state.month])_jscallog("Loading matrix from local cache"),done&&done();else if(this.options.datasource){var request=new XMLHttpRequest;for(var header in this.options.datasourceHeaders)request.setRequestHeader(header,this.options.datasourceHeaders[header]);var dim=JSCalendar.getDaysInMonth(this.state.year,this.state.month),from=new Date(this.state.year,this.state.month,1),to=new Date(this.state.year,this.state.month,dim.numberOfDays),firstStamp=from.getTime()-864e5*from.getDay(),endStamp=to.getTime()+864e5*(6-to.getDay())+864e5-1,url=this.options.datasource,evObject={url:url+=(-1!=url.indexOf("?")?"&":"?")+"year="+this.state.year+"&month="+this.state.month+"&day="+this.state.day+"&view="+this.state.view+"&startstamp="+firstStamp+"&endstamp="+endStamp};this.fire("willFetch",evObject),request.onreadystatechange=function(){if(request.readyState==XMLHttpRequest.DONE&&200==request.status)try{var maybeMatrix=JSON.parse(request.responseText);_this9.fire("fetched",maybeMatrix),(_this9.options.fetchReplaces?_this9.setMatrix(maybeMatrix):_this9.appendMatrix(maybeMatrix))?(_jscallog("Updated matrix from data source"),done&&done(void 0,maybeMatrix)):(_jscallog("Received invalid matrix"),done&&done(new Error("Invalid matrix size"),maybeMatrix))}catch(err){_jscallog("Caught error during matrix parsing : "+err),done&&done(err)}else request.status&&200!=request.status&&(_jscallog("Received non-200 HTTP response code : "+request.status),done&&done(new Error("Non-200 HTTP response code : "+request.status),request.status))},_jscallog("Sending async request to data source : "+this.options.datasource),request.open("GET",evObject.url),request.send()}else _jscallog("Created new entry in matrix for "+this.state.year+"/"+this.state.month),this.state.matrix[this.state.year]||(this.state.matrix[this.state.year]={0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),this.state.matrix[this.state.year][this.state.month]||(this.state.matrix[this.state.year][this.state.month]={}),done&&done(new Error("Invalid datasource"));return this}}],[{key:"getDaysInMonth",value:function(year,month){return{numberOfDays:[31,year%4==0&&(year%100!=0||year%400==0)?29:28,31,30,31,30,31,31,30,31,30,31][month],firstDay:new Date(year,month).getDay()}}},{key:"on",value:function(event,callback){JSCalendar.hooks[event]=JSCalendar.hooks[event]||[],JSCalendar.hooks[event].push(callback)}},{key:"fire",value:function(event,instance,extra){(JSCalendar.hooks[event]||[]).forEach(function(e){e(instance,extra)})}},{key:"emptyElem",value:function(elem){if(elem)for(;elem.firstElementChild;)elem.firstElementChild.remove()}},{key:"defaultMatrix",value:function(){var _ref,year=(new Date).getFullYear();return _defineProperty(_ref={},year-1,{0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),_defineProperty(_ref,year,{0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),_defineProperty(_ref,year+1,{0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),_ref}},{key:"createState",value:function(){var now=new Date;return{view:"month",matrix:JSCalendar.defaultMatrix(),matrixmonth:now.getMonth(),year:now.getFullYear(),month:now.getMonth(),day:now.getDate(),weekday:now.getDay(),dragging:!1}}},{key:"getInstance",value:function(id){return _jsCalWrapper.instances[id]}},{key:"find",value:function(wrapper){for(var calendarElems=(wrapper||document).querySelectorAll(JSCalendar.defaultOptions.globalSelector),i=0;i<calendarElems.length;i++){var elem=calendarElems[i],id=elem.id||"js-calendar-"+i;_jsCalWrapper.instances[id]=new JSCalendar(elem).init()}return JSCalendar}},{key:"defaultOptions",get:function(){return{views:["day","week","month"],viewsVocab:{day:"Day",week:"Week",month:"Month"},buttons:["previous","today","next"],buttonsActions:{previous:"goBack",today:"goNow",next:"goNext"},buttonsVocab:{previous:"<",today:"Today",next:">"},monthsVocab:["January","February","March","April","May","June","July","August","September","October","November","December"],daysVocab:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],nthVocab:{1:"st",2:"nd",3:"rd",default:"th"},emptyDayVocab:"Nothing here.",noDate:"Somewhen",nonameEventVocab:"Event without a name",globalSelector:".js-calendar",eventBackground:"rgb(126, 156, 193)",titleCropSize:20,dayviewGapMinutes:30,dayviewNoTimeGapSize:2,dayviewGapHeight:38,datasource:"",datasourceHeaders:{},ampm:!0,displaySeconds:!1,alwaysFetch:!1,fetchReplaces:!1}}}]),JSCalendar}();JSCalendar.hooks={},document.addEventListener("DOMContentLoaded",function(){toggleDropdownMobile(),"/"===document.location.pathname?navBrandAnimation("logo-animation",2500,400):mainNavBrandAnimation("main-logo-animation")}),document.addEventListener("DOMContentLoaded",function(){"/pages/programs/human-wellness.html"===window.location.pathname?enableTabs("HWTabs"):"/pages/programs/seasonal.html"===window.location.pathname?enableTabs("SeasonsTabs"):"/pages/get-involved/opportunities.html"===window.location.pathname&&enableTabs("OpportunitiesTabs")});